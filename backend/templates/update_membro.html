<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <title>Alterando usu√°rio</title>
    <meta charset="UTF-8" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
      $(document).ready(function () {
        const params = new URLSearchParams(window.location.search);

        const id = params.get("id");

        $.ajax({
          url: "http://localhost:5000/get-equipes",
          type: "POST",
          dataType: "json",
          data: "",
          success: function (result) {
            //alert("tarefa criado com sucesso!");
            const select = $("#equipe-select");
            result.forEach((e) => {
              select.append(`<option value="${e._id.$oid}">${e.nome}</option>`);
            });
            //window.location.href = "/";
            console.log(result);
          },
          error: function (xhr, resp, text) {
            console.log(xhr, resp, text);
          },
        });

        $.ajax({
          url: `http://localhost:5000/get-membros/${id}`,
          type: "POST",
          dataType: "json",
          data: "",
          success: function (result) {
            //alert("tarefa criado com sucesso!");

            $("input[name='nome']").val(result.nome);

            $("input[name='email']").val(result.email);
            $("select[name='equipe_id']").val(result.equipe_id.$oid);
            console.log(result.admin);
            $("input[name='admin']").prop("checked", result.admin);

            //window.location.href = "/";
            console.log(result);
          },
          error: function (xhr, resp, text) {
            console.log(xhr, resp, text);
          },
        });

        $("#submit").on("click", function () {
          let arr = $("#form").serializeArray();
          let json_data = {};

          // transforma em objeto
          arr.forEach((item) => (json_data[item.name] = item.value));

          // adiciona o id
          json_data.id = id;
          $.ajax({
            url: "http://localhost:5000/update-membro",
            type: "POST",
            dataType: "json",
            data: json_data,
            success: function (result) {
              alert(result.mensagem);
              window.location.href = "/";
              console.log(result);
            },
            error: function (xhr, resp, text) {
              console.log(xhr, resp, text);
            },
          });
        });
      });
    </script>
  </head>
  <body>
    <form id="form" action="" method="post">
      Nome: <input type="text" name="nome" value="" size="50" /><br />
      E-mail: <input type="text" name="email" value="" size="50" /><br />
      Equipe:
      <select name="equipe_id" id="equipe-select">
        <option value="">--Escolha uma equipe--</option>
      </select>
      <input type="checkbox" name="admin" /> Admin <br />
      <input id="submit" type="button" value="Enviar" />
    </form>
  </body>
</html>
